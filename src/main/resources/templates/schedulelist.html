<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>스케줄 리스트</title>
</head>
<style>
    /*!* 모든 요소에 box-sizing을 border-box로 설정 *!*/
    /** {*/
    /*    box-sizing: border-box;*/
    /*}*/

    /*!* 추가로, ::before와 ::after 의사 요소에도 적용 *!*/
    /**::before,*/
    /**::after {*/
    /*    box-sizing: border-box;*/
    /*}*/
    /* headDiv 시작 */
    .headDiv {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 90px;
    }
    .allaTagDiv {
        display: flex;
        justify-content: space-around;
        align-items: center;
    }
    .scheduleDiv {
        height: 60px;
        width: 60px;
        border: solid 1px #868e96;
        border-radius: 50%;
        background: #adb5bd;
        position: relative;
        margin: 5px;
    }
    .scheduleBtn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-decoration: none;
        font-size: 10px;
        color: white;
    }
    .aTagDiv {
        height: 60px;
        width: 60px;
        border: solid 1px #adb5bd;
        border-radius: 50%;
        background: white;
        position: relative;
        margin: 5px;
    }
    .aTagBtn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-decoration: none;
        font-size: 10px;
        color: #868e96;
    }
    .scheduleBtn:hover {
        font-weight: bold;
    }
    .aTagBtn:hover {
        color: black;
        font-weight: bold;
    }
    .teamSelectBox{
        height: 40px;
        width: 120px;
        border: 1px solid #868e96;
        border-radius: 10px;
        font-size: 13px;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
    }
    /* listBox 시작 */
    .listBox {
        display: flex;
        justify-content: space-around;
        align-items: center;
    }
    .dateDiv {
        text-align: center;
    }
    #scheduleYear {
        margin: 0;
        color: #868e96;
    }
    .monthStyle {
        color: #495057;
        font-size: 30px;
        font-weight: bolder;
        margin: 0;
    }
    .employeeListBox {
        background: #ced4da;
        border-right: 1px solid #ced4da;
        color: white;
        height: 40px;
        width: 180px;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        font-size: 13px;
        font-weight: bolder;
        flex-shrink: 0;
    }
    .teamListDiv {
        display: flex;
    }
    .teamBox{
        width: 50px;
        color: white;
        background: #495057;
        border-bottom: 1px solid white;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    .employees {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
    }
    .employeeBox {
        height: 40px;
        width: 130px;
        color: #495057;
        border-bottom: 1px solid #adb5bd;
        border-right: 1px solid #adb5bd;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #daysBox {
        margin-top: 15px;
        overflow-x: auto; /* 가로 스크롤을 활성화 */
    }
    #dayListBox {
        display: flex;
        flex-wrap: nowrap; /* 가로로 아이템들이 줄 바꿈 없이 나열되도록 설정 */
        white-space: nowrap;
    }
    .scheduleDayBox {
        display: flex;
        flex-wrap: nowrap; /* 가로로 아이템들이 줄 바꿈 없이 나열되도록 설정 */
        white-space: nowrap;
    }
    .dayBox {
        height: 40px;
        width: 50px;
        background: #adb5bd;
        color: #495057;
        border-right: 1px solid white;
        text-align: center;
        line-height: 40px;
        flex-shrink: 0;
    }
    .closeDayBox {
        height: 40px;
        width: 50px;
        border-bottom: 1px solid #adb5bd;
        border-right: 1px solid #adb5bd;
        text-align: center;
        line-height: 40px;
        flex-shrink: 0;
        font-size: 13px;
        font-weight: bold;
        color: #495057;
        background-color: white;
    }
    .closeDayBox:hover {
        background: #ced4da;
        cursor: pointer;
    }
</style>
<body>
<div class="headDiv">
    <div class="allaTagDiv">
        <div class="scheduleDiv">
            <a href="/schedule/list" class="scheduleBtn">스케줄</a>
        </div>
        <div class="aTagDiv">
            <a href="/employee/list" class="aTagBtn">직원</a>
        </div>
        <div class="aTagDiv">
            <a href="/team/list" class="aTagBtn">팀</a>
        </div>
    </div>
    <div class="dateDiv">
        <p id="scheduleYear"></p>
        <p class="monthStyle"><span id="scheduleMonth"></span><span>월</span></p>
    </div>
    <div class="teamSelectBox">
        <span>전체 팀</span>
    </div>
</div>
<div class="listBox">
    <div>
        <div class="employeeListBox">직원 목록</div>
        <div th:each="entry : ${teamMemberMap}">
            <div class="teamListDiv">
                <div th:text="${entry.key}" class="teamBox"></div>
                <div class="employees">
                    <div th:each="teamMember : ${entry.value}" class="employeeBox" th:attr="data-employee-id=${teamMember.employeeId}">
                        <span th:text="${teamMember.member_name}"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="daysBox">
        <div id="dayListBox"></div>
        <div id="scheduleDaysBox"></div>
    </div>
</div>

<!-- sList 데이터를 자바스크립트로 전달 -->
<script th:inline="javascript">
    /*<![CDATA[*/
    const sList = /*[[${sList}]]*/ [];
    /*]]>*/
</script>

<script>
    document.addEventListener("DOMContentLoaded", function (){
        // sList를 JSON 형식으로 변환
        const scheduleYear = document.getElementById('scheduleYear');
        const scheduleMonth = document.getElementById('scheduleMonth');
        const today = new Date();
        let year = today.getFullYear();
        let month = today.getMonth() + 1;
        scheduleYear.textContent = year;
        scheduleMonth.textContent = month;

        const teamListDivs = document.querySelectorAll('.teamListDiv');
        let totalEmployeeBoxCount = 0;
        // 직원번호 저장을 위한 배열
        const employeeIds = [];

        teamListDivs.forEach(function (teamListDiv) {
            const teamBox = teamListDiv.querySelector('.teamBox');
            const employeeBoxes = teamListDiv.querySelectorAll('.employeeBox');

            const employeeBoxCount = employeeBoxes.length;
            totalEmployeeBoxCount += employeeBoxCount;

            const employeeBoxHeight = employeeBoxes[0].offsetHeight;
            const totalHeight = employeeBoxes.length * employeeBoxHeight;
            teamBox.style.height = totalHeight + 'px';

            // 직원 박스에서 직원 번호 추출
            employeeBoxes.forEach(function (employeeBox){
               const employeeId = employeeBox.getAttribute('data-employee-id');
               employeeIds.push(employeeId);
            });
        });

        for (let i = 1; i<= totalEmployeeBoxCount; i++) {
            const scheduleDayBox = document.createElement('div');
            scheduleDayBox.className = 'scheduleDayBox';
            scheduleDaysBox.appendChild(scheduleDayBox);
            if (employeeIds[i - 1]) {
                if (month === 11) { // month가 11월인 경우
                    for (let j = 1; j <= 30; j++) {
                        const closeDayBox = document.createElement('div');
                        closeDayBox.className = 'closeDayBox';
                        scheduleDayBox.appendChild(closeDayBox);
                    }
                }
                if (month === 12) { // month가 12월인 경우
                    for (let j = 1; j <= 31; j++) {
                        const closeDayBox = document.createElement('div');
                        closeDayBox.className = 'closeDayBox';

                        const hiddenData = document.createElement('input');
                        hiddenData.type = 'hidden';
                        hiddenData.value = `${year}-${month}-${j}`;
                        hiddenData.setAttribute('data-employee-id', employeeIds[i - 1]);

                        // sList와 날짜, 직원 번호 대조 후 색상 변경
                        const dateString = `${year}-${String(month).padStart(2, '0')}-${String(j).padStart(2, '0')}`;
                        const employeeIdData = String(employeeIds[i - 1]);
                        sList.forEach(item => {
                            const itemDateString = new Date(item.closedDay).toISOString().split('T')[0];
                            const itemImployeeId = String(item.employeeId);
                            if (itemImployeeId === employeeIdData && itemDateString === dateString) {
                                closeDayBox.style.backgroundColor = '#FFEB00';
                                closeDayBox.textContent = '휴무';
                            }
                        });

                        scheduleDayBox.appendChild(closeDayBox);
                        closeDayBox.appendChild(hiddenData);
                    }
                }
            }
        }
        // 휴무일 추가를 위한 이벤트 리스너 추가
        const closeDayBoxes = document.getElementsByClassName("closeDayBox");
        Array.from(closeDayBoxes).forEach(function(closeDayBox) {
            closeDayBox.addEventListener('click', closed);
        });
        function closed() {
            alert("휴무를 추가하시겠습니까?");
        }

        if (month === 11) { // month가 11월인 경우
            for (let i = 1; i <= 30; i++) {
                const dayBox = document.createElement('div');
                dayBox.className = 'dayBox';
                dayBox.textContent = i;
                dayListBox.appendChild(dayBox);
            }
        }

        if (month === 12) { // month가 12월인 경우
            for (let i = 1; i <= 31; i++) {
                const dayBox = document.createElement('div');
                dayBox.className = 'dayBox';
                dayBox.textContent = i;
                dayListBox.appendChild(dayBox);
            }
        }
    });
</script>
</body>
</html>